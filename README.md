# GreenHouse - Магазин растений
МДиСУБД, 353501, Пранюк Екатерина Дмитриевна

## Описание
Проект представляет собой систему управления магазином растений, включающую функциональность для управления пользователями, заказами, растениями, поставщиками и ролями. Система будет интегрирована с базой данных PostgreSQL.

## Функциональные требования
1. **Авторизация/аутентификация пользователя**:
   Система должна обеспечивать возможность пользователям входить в свою учетную запись и выходить из нее.
   Регистрация нового пользователя с проверкой уникальности email.
   Вход в систему с использованием email и пароля.

2. **Управление пользователями (CRUD)**: 
   Система должна предоставлять функциональность для управления пользователями, включая создание, чтение, обновление и удаление учетных записей.
   Администраторы могут создавать новых пользователей.
   Просмотр списка всех пользователей с возможностью фильтрации.
   Обновление информации о пользователях (например, изменение пароля, имени, роли).
   Удаление учетных записей пользователей.

3. **Система ролей и разрешений**: 
   Система должна поддерживать различные роли пользователей (администратор, менеджер, клиент) с гибкой системой разрешений.
   Динамическое управление правами доступа через таблицу разрешений.

4. **Журналирование действий пользователя**: 
   Система должна вести журнал действий пользователей для обеспечения безопасности и отслеживания изменений.
   Возможность просмотра журнала действий администратором.
   Фильтрация журнала по дате, пользователю и типу действия.

5. **Система заказов**: 
   Система позволяет совершать заказы на одно или несколько растений.
   Заказы помещаются в корзине и имеют несколько статусов: ожидает оплаты, собирается, доставляется, выполнен.
   Все сделанные заказы отображаются в истории заказов.

6. **Управление каталогом растений**: 
   Система предоставляет возможность управления каталогом растений, включая добавление, редактирование и удаление позиций.
   Фильтрация растений по категориям, цене, сложности ухода.

7. **Система ухода за растениями**: 
   Система содержит руководства по уходу за растениями с рекомендациями по поливу, освещению и другим параметрам.

## Нормализация базы данных
База данных приведена к **третьей нормальной форме (3NF)**:
- ✅ **1NF**: Все поля атомарны, нет повторяющихся групп
- ✅ **2NF**: Нет частичных зависимостей от составных ключей
- ✅ **3NF**: Нет транзитивных зависимостей, вычисляемые поля вынесены в представления

## Список таблиц для БД:
![Диаграмма БД](diagram.png)

## Описание таблиц:

1. **User (Пользователь)**
   Назначение: Учетные записи всех пользователей системы.
   Поля:
   - user_id: Уникальный идентификатор пользователя (PK)
   - username: Имя пользователя
   - email: Электронная почта пользователя (уникальна)
   - password_hash: Хэш пароля
   - first_name: Имя
   - last_name: Фамилия
   - phone: Номер телефона
   - role_id: Идентификатор роли (FK)
   - created_at: Дата регистрации
   - last_login: Дата последнего входа
   - is_active: Флаг активности пользователя
   Связь: Имеет много Order, UserLog, DeliveryAddress и одну Cart.

2. **Role (Роль)**
   Назначение: Система ролей пользователей.
   Поля:
   - role_id: Уникальный идентификатор роли (PK)
   - role_name: Название роли
   - description: Описание роли
   Связь: Имеет много User, имеет много Permission через RolePermission.

3. **Permission (Разрешение)**
   Назначение: Система разрешений для ролей.
   Поля:
   - permission_id: Уникальный идентификатор разрешения (PK)
   - permission_name: Название разрешения
   - description: Описание разрешения
   Связь: Имеет много Role через RolePermission.

4. **RolePermission (Связь ролей и разрешений)**
   Назначение: Связь многие-ко-многим между ролями и разрешениями.
   Поля:
   - role_id: Идентификатор роли (FK)
   - permission_id: Идентификатор разрешения (FK)
   Связь: Соединяет Role и Permission.

5. **UserLog (Журнал действий)**
   Назначение: Логирование действий пользователей.
   Поля:
   - log_id: Уникальный идентификатор записи (PK)
   - user_id: Идентификатор пользователя (FK)
   - action_type: Тип действия
   - action_details: Детали действия
   - ip_address: IP-адрес
   - user_agent: User agent браузера
   - created_at: Время действия
   Связь: Принадлежит одному User.

6. **Plant (Растение)**
   Назначение: Каталог растений магазина.
   Поля:
   - plant_id: Уникальный идентификатор растения (PK)
   - name: Название растения
   - scientific_name: Научное название
   - description: Описание растения
   - price: Цена
   - stock_quantity: Количество в наличии
   - category_id: Идентификатор категории (FK)
   - supplier_id: Идентификатор поставщика (FK)
   - care_level: Уровень сложности ухода
   - light_requirements: Требования к освещению
   - watering_frequency: Частота полива
   - max_height: Максимальная высота
   - is_available: Доступно для продажи
   - created_at: Дата добавления
   Связь: Принадлежит одной Category и одному Supplier, входит в многие OrderItem и CartItem.

7. **Category (Категория)**
   Назначение: Категории растений.
   Поля:
   - category_id: Уникальный идентификатор категории (PK)
   - name: Название категории
   - description: Описание категории
   - image_url: Ссылка на изображение
   Связь: Имеет много Plant.

8. **Supplier (Поставщик)**
   Назначение: Поставщики растений.
   Поля:
   - supplier_id: Уникальный идентификатор поставщика (PK)
   - company_name: Название компании
   - contact_person: Контактное лицо
   - email: Электронная почта
   - phone: Телефон
   - address: Адрес
   - is_active: Активный поставщик
   Связь: Имеет много Plant.

9. **Order (Заказ)**
   Назначение: Заказы клиентов.
   Поля:
   - order_id: Уникальный идентификатор заказа (PK)
   - user_id: Идентификатор пользователя (FK)
   - order_date: Дата заказа
   - total_amount: Общая сумма
   - status: Статус заказа
   - delivery_address_id: Идентификатор адреса доставки (FK)
   - shipping_cost: Стоимость доставки
   - notes: Примечания к заказу
   Связь: Принадлежит одному User, содержит много OrderItem, имеет один DeliveryAddress.

10. **OrderItem (Элемент заказа)**
    Назначение: Состав заказа.
    Поля:
    - order_item_id: Уникальный идентификатор элемента (PK)
    - order_id: Идентификатор заказа (FK)
    - plant_id: Идентификатор растения (FK)
    - quantity: Количество
    - unit_price: Цена за единицу
    Связь: Соединяет Order и Plant.

11. **CareGuide (Руководство по уходу)**
    Назначение: Инструкции по уходу за растениями.
    Поля:
    - guide_id: Уникальный идентификатор руководства (PK)
    - title: Заголовок
    - content: Содержание руководства
    - author_id: Идентификатор автора (FK)
    - created_at: Дата создания
    - updated_at: Дата обновления
    Связь: Принадлежит одному User, имеет много Plant через PlantCare.

12. **PlantCare (Связь растения с руководством)**
    Назначение: Связь многие-ко-многим между растениями и руководствами.
    Поля:
    - plant_id: Идентификатор растения (FK)
    - guide_id: Идентификатор руководства (FK)
    - priority: Приоритет отображения
    Связь: Соединяет Plant и CareGuide.

13. **DeliveryAddress (Адрес доставки)**
    Назначение: Адреса доставки пользователей.
    Поля:
    - address_id: Уникальный идентификатор адреса (PK)
    - user_id: Идентификатор пользователя (FK)
    - address_line1: Адрес строка 1
    - address_line2: Адрес строка 2
    - city: Город
    - state: Область/штат
    - postal_code: Почтовый индекс
    - country: Страна
    - is_default: Адрес по умолчанию
    Связь: Принадлежит одному User, используется в Order.

14. **Cart (Корзина)**
    Назначение: Временное хранение товаров перед оформлением заказа.
    Поля:
    - cart_id: Уникальный идентификатор корзины (PK)
    - user_id: Идентификатор пользователя (FK)
    - created_at: Дата создания
    - updated_at: Дата обновления
    Связь: Принадлежит одному User, содержит много CartItem.

15. **CartItem (Элемент корзины)**
    Назначение: Товары в корзине.
    Поля:
    - cart_item_id: Уникальный идентификатор элемента (PK)
    - cart_id: Идентификатор корзины (FK)
    - plant_id: Идентификатор растения (FK)
    - quantity: Количество
    - added_at: Дата добавления
    Связь: Соединяет Cart и Plant.

## Представления (Views)

1. **OrderItemWithSubtotal**
   - Назначение: Отображение элементов заказа с вычисляемым подытогом
   - Поля: order_item_id, order_id, plant_id, quantity, unit_price, subtotal

2. **UserInfo**
   - Назначение: Полная информация о пользователях с названиями ролей
   - Поля: user_id, username, email, first_name, last_name, phone, role_name, created_at, last_login, is_active

3. **PlantDetails**
   - Назначение: Детальная информация о растениях с категориями и поставщиками
   - Поля: plant_id, name, scientific_name, description, price, stock_quantity, category_name, supplier_name, care_level, light_requirements, watering_frequency, max_height, is_available

4. **RolePermissionsView**
   - Назначение: Разрешения для каждой роли
   - Поля: role_name, permission_name, permission_description

